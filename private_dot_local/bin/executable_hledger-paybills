#!/bin/bash
tags=(paycheck savings bill autopay payperiod)
today=$(date "+%Y-%m-%d")
echo "$today"

function get_trans()
    {
    tag=$1
    faketime "$today" hledger -f $LEDGER/budget.ledger print --forecast="until $(faketime "$today" hledger-payday)" tag:"$tag"
    }

for tag in "${tags[@]}"
do

    case "$tag" in

        savings | bill)
            # change date to today; leave transaction unmarked
            get_trans "$tag" | sed 's/[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}/'"$today"'/g;/generated-transaction/d' >> $LEDGER/register.ledger
            ;;
        
        paycheck )
            # keep date intact; mark transaction cleared
            get_trans "$tag" | sed 's/[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}/& */g;/generated-transaction/d' >> $LEDGER/register.ledger
            ;;
            
        autopay )
            # keep date intact; mark transaction pending
            get_trans "$tag" | sed 's/[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}/& !/g;/generated-transaction/d' >> $LEDGER/register.ledger
            ;;

        payperiod)
            # keep date intact; mark transaction cleared
            get_trans "$tag" | sed 's/[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}/& */g;/generated-transaction/d' > $LEDGER/payday.ledger
            ;;

    esac

# after writing to files sort 'register.ledger' and get ready to input pay amount in vim
done && nvim -c "LedgerSort" -c "?paycheck" -c "/USD" -c "norm n3bd3wi " -c "noh" -c "startinsert" $LEDGER/register.ledger 
